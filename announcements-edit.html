<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Manage Announcements â€” Teacher</title>

  <style>
    :root {
      --accent: #2d66ff;
      --danger: #ff3b30;
      --card: rgba(255,255,255,0.65);
      --blur: blur(22px);
      --muted: #6b7280;
      --text-dark: #1f2937;
    }
    body {
      margin: 0;
      font-family: "Inter", sans-serif;
      background: linear-gradient(135deg, #dce7ff, #eef3ff, #ffffff);
      padding: 40px 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
      color: var(--text-dark);
    }
    .nav {
      width: 95%;
      max-width: 950px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    button {
      cursor: pointer;
      border: none;
      border-radius: 12px;
      padding: 10px 18px;
      font-weight: 600;
    }
    #signOutBtn {
      background: var(--danger);
      color: white;
    }
    .card {
      width: 95%;
      max-width: 950px;
      background: var(--card);
      backdrop-filter: var(--blur);
      border-radius: 20px;
      padding: 25px;
      margin-top: 25px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.1);
    }
    .ann {
      background: white;
      padding: 18px;
      border-radius: 14px;
      margin-bottom: 15px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
      display: flex;
      justify-content: space-between;
      gap: 14px;
      border-left: 5px solid var(--accent);
    }
    .meta {
      font-size: 13px;
      margin-top: 4px;
      color: var(--muted);
    }
    .small-btn {
      padding: 8px 14px;
      border-radius: 10px;
      font-size: 14px;
      cursor: pointer;
    }
    .edit { background: #fff7c2; }
    .delete { background: #ffd1d1; }
  </style>
</head>

<body>

<div class="nav">
  <h1>ðŸ“£ Manage Announcements</h1>
  <button id="signOutBtn">Sign Out</button>
</div>

<div class="card">
  <h2>Post New Announcement</h2>
  <input id="title" placeholder="Title">
  <textarea id="message" placeholder="Write message..."></textarea>
  <button class="primary" id="postBtn">Post Announcement</button>
</div>

<div class="card">
  <h2>All Announcements</h2>
  <div id="annList">Loading...</div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
  const firebaseConfig = {
    apiKey:"AIzaSyB3Lv_9EiVBVy5aXwiYOn0pgZu31ykFOGM",
    authDomain:"digitalbellplisworkthistime.firebaseapp.com",
    databaseURL:"https://digitalbellplisworkthistime-default-rtdb.firebaseio.com",
    projectId:"digitalbellplisworkthistime",
    storageBucket:"digitalbellplisworkthistime.firebasestorage.app",
    messagingSenderId:"829189847707",
    appId:"1:829189847707:web:99b13d5fe551b54d9ce43e"
  };

  if (!firebase.apps.length) {
    firebase.initializeApp(firebaseConfig);
  }

  const db = firebase.database();
  const auth = firebase.auth();
  const adminUID = "lPvZ7WGuTVP1LcYvKjGYtOj1GBD3";

  auth.onAuthStateChanged(user => {
    if (!user || user.uid !== adminUID) location.href = "index.html";
  });

  document.getElementById("postBtn").onclick = () => {
    const t = title.value.trim();
    const m = message.value.trim();
    if (!t || !m) return alert("Fill all fields");
    db.ref("announcements").push({
      title: t,
      message: m,
      timestamp: Date.now(),
      postedBy: auth.currentUser.email
    });
    title.value = "";
    message.value = "";
  };

  db.ref("announcements")
    .orderByChild("timestamp")
    .on("value", snap => {
      const box = document.getElementById("annList");
      box.innerHTML = "";

      if (!snap.exists()) {
        box.innerHTML = `<div style="color:#666">No announcements.</div>`;
        return;
      }

      const arr = [];
      snap.forEach(s => arr.push({ id: s.key, ...s.val() }));
      arr.reverse();

      arr.forEach(a => {
        box.insertAdjacentHTML("beforeend", `
          <div class="ann">
            <div>
              <h3>${escapeHtml(a.title)}</h3>
              <p>${escapeHtml(a.message)}</p>
              <div class="meta">
                Posted by ${escapeHtml(a.postedBy)} Â·
                ${new Date(a.timestamp).toLocaleString()}
              </div>
            </div>
            <div>
              <button class="small-btn edit" onclick="editAnn('${a.id}')">Edit</button>
              <button class="small-btn delete" onclick="delAnn('${a.id}')">Delete</button>
            </div>
          </div>
        `);
      });
    });

  function editAnn(id) {
    db.ref("announcements/"+id).once("value").then(s => {
      const v = s.val();
      const nt = prompt("Edit title:", v.title);
      if (nt === null) return;
      const nm = prompt("Edit message:", v.message);
      if (nm === null) return;
      db.ref("announcements/"+id).update({ title: nt, message: nm });
    });
  }

  function delAnn(id) {
    if (confirm("Delete this announcement?")) {
      db.ref("announcements/"+id).remove();
    }
  }

  function escapeHtml(t) {
    return String(t ?? "").replace(/[&<>]/g, c => ({
      "&":"&amp;",
      "<":"&lt;",
      ">":"&gt;"
    }[c]));
  }
</script>

</body>
</html>
