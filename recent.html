<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Recent Changes</title>

<style>
    body {
        font-family: "Inter", Arial, sans-serif;
        background: #ffffff;
        margin: 0;
        padding: 40px 0;
        display: flex;
        justify-content: center;
    }

    .container {
        width: 92%;
        max-width: 900px;
        background: #fff;
        padding: 30px;
        border-radius: 14px;
        border: 1px solid #000;
    }

    h2 {
        text-align: center;
        font-size: 32px;
        margin-bottom: 20px;
        font-weight: 700;
        color: #000;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* Table */
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        border: 1px solid black;
    }

    th {
        background: #000;
        color: white;
        font-weight: 600;
        padding: 12px;
        font-size: 14px;
        border: 1px solid black;
    }

    td {
        padding: 12px;
        border: 1px solid #000;
        font-size: 14px;
        text-align: center;
        color: #111;
    }

    tr:nth-child(even) {
        background: #f5f5f5;
    }

    .timestamp {
        font-size: 13px;
        color: #333;
    }

    .loading {
        text-align: center;
        padding: 20px;
        color: #777;
        font-size: 16px;
    }
</style>

</head>

<body>

<div class="container">
    <h2>Recent Timetable Changes</h2>

    <table>
        <thead>
            <tr>
                <th>Date & Time</th>
                <th>Teacher</th>
                <th>Batch</th>
                <th>Day</th>
                <th>Period</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="changesBody">
            <tr><td colspan="6" class="loading">Loading...</td></tr>
        </tbody>
    </table>
</div>


<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
<script src="firebase-config.js"></script>

<script>
/* SAFER VALUE CLEANER */
function safe(x) {
    return (x === undefined || x === null || x === "") ? "N/A" : x;
}

/* ðŸ”¥ LOAD ALL RECENT CHANGES */
function loadRecentChanges() {
    const tbody = document.getElementById("changesBody");
    tbody.innerHTML = `<tr><td colspan="6" class="loading">Loading...</td></tr>`;

    firebase.database().ref("recentChanges")
    .orderByChild("timestamp")
    .limitToLast(120)
    .once("value")
    .then(snap => {
        tbody.innerHTML = "";

        if (!snap.exists()) {
            tbody.innerHTML = `<tr><td colspan="6">No recent changes found.</td></tr>`;
            return;
        }

        const entries = Object.values(snap.val()).reverse();

        entries.forEach(item => {
            const date = safe(item.timestamp ? new Date(item.timestamp).toLocaleString() : "N/A");

            tbody.innerHTML += `
                <tr>
                    <td class="timestamp">${date}</td>
                    <td>${safe(item.teacher)}</td>
                    <td>${safe(item.batch)}</td>
                    <td>${safe(item.day)}</td>
                    <td>${safe(item.period)}</td>
                    <td>${safe(item.action)}</td>
                </tr>
            `;
        });
    })
    .catch(() => {
        tbody.innerHTML = `<tr><td colspan="6">Error loading updates.</td></tr>`;
    });
}

loadRecentChanges();
</script>

</body>
</html>
